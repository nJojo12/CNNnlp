Improved CNN Text Classifier for Harry Potter Books
============================================================
Loaded pre-trained embeddings: (1316, 100)
Loaded HP1: 347 pages
Loaded HP2: 377 pages
Loaded HP3: 486 pages
Loaded HP4: 808 pages
Loaded HP5: 1104 pages
Loaded HP6: 728 pages
Loaded HP7: 849 pages
Using pre-trained vocabulary: 1316 words + padding = 1317 total
Index range: 0 (padding) to 1316
Created 7388 training samples
Sequence shape: (7388, 150)
Labels shape: (7388, 7)
Vocabulary size for embedding layer: 1317
Max index in sequences: 1316
Min index in sequences: 0
All indices are within bounds - should work correctly!

Class distribution:
  HP1: 515 samples
  HP2: 571 samples
  HP3: 697 samples
  HP4: 1357 samples
  HP5: 1751 samples
  HP6: 1144 samples
  HP7: 1353 samples
Found pre-trained embeddings for 1316/1317 words
Embedding matrix shape: (1317, 100)
Using pre-trained embeddings

Model architecture:
Model: "functional"
┏━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━┓
┃ Layer (type)        ┃ Output Shape      ┃    Param # ┃ Connected to      ┃
┡━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━┩
│ input_layer         │ (None, 150)       │          0 │ -                 │
│ (InputLayer)        │                   │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ embedding           │ (None, 150, 100)  │    131,700 │ input_layer[0][0] │
│ (Embedding)         │                   │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ dropout (Dropout)   │ (None, 150, 100)  │          0 │ embedding[0][0]   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ conv1d (Conv1D)     │ (None, 150, 128)  │     38,528 │ dropout[0][0]     │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ conv1d_1 (Conv1D)   │ (None, 150, 128)  │     51,328 │ dropout[0][0]     │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ conv1d_2 (Conv1D)   │ (None, 150, 128)  │     64,128 │ dropout[0][0]     │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ global_max_pooling… │ (None, 128)       │          0 │ conv1d[0][0]      │
│ (GlobalMaxPooling1… │                   │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ global_max_pooling… │ (None, 128)       │          0 │ conv1d_1[0][0]    │
│ (GlobalMaxPooling1… │                   │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ global_max_pooling… │ (None, 128)       │          0 │ conv1d_2[0][0]    │
│ (GlobalMaxPooling1… │                   │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ concatenate         │ (None, 384)       │          0 │ global_max_pooli… │
│ (Concatenate)       │                   │            │ global_max_pooli… │
│                     │                   │            │ global_max_pooli… │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ concatenate_1       │ (None, 384)       │          0 │ concatenate[0][0] │
│ (Concatenate)       │                   │            │                   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ dense (Dense)       │ (None, 256)       │     98,560 │ concatenate_1[0]… │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ dropout_1 (Dropout) │ (None, 256)       │          0 │ dense[0][0]       │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ dense_1 (Dense)     │ (None, 128)       │     32,896 │ dropout_1[0][0]   │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ dropout_2 (Dropout) │ (None, 128)       │          0 │ dense_1[0][0]     │
├─────────────────────┼───────────────────┼────────────┼───────────────────┤
│ dense_2 (Dense)     │ (None, 7)         │        903 │ dropout_2[0][0]   │
└─────────────────────┴───────────────────┴────────────┴───────────────────┘
 Total params: 418,043 (1.59 MB)
 Trainable params: 286,343 (1.09 MB)
 Non-trainable params: 131,700 (514.45 KB)

Data splits:
  Training: 4728 samples
  Validation: 1182 samples
  Testing: 1478 samples

Training model...
Epoch 1/20
[1m 1/74[0m [37m━━━━━━━━━━━━━━━━━━━━[0m [1m12:24[0m 10s/step - accuracy: 0.2031 - loss: 2.8101[1m13/74[0m [32m━━━[0m[37m━━━━━━━━━━━━━━━━━[0m [1m0s[0m 4ms/step - accuracy: 0.1956 - loss: 2.4658   [1m26/74[0m [32m━━━━━━━[0m[37m━━━━━━━━━━━━━[0m [1m0s[0m 4ms/step - accuracy: 0.1991 - loss: 2.3205[1m38/74[0m [32m━━━━━━━━━━[0m[37m━━━━━━━━━━[0m [1m0s[0m 4ms/step - accuracy: 0.2022 - loss: 2.2468[1m50/74[0m [32m━━━━━━━━━━━━━[0m[37m━━━━━━━[0m [1m0s[0m 4ms/step - accuracy: 0.2030 - loss: 2.1998[1m61/74[0m [32m━━━━━━━━━━━━━━━━[0m[37m━━━━[0m [1m0s[0m 4ms/step - accuracy: 0.2029 - loss: 2.1693[1m73/74[0m [32m━━━━━━━━━━━━━━━━━━━[0m[37m━[0m [1m0s[0m 4ms/step - accuracy: 0.2035 - loss: 2.1437[1m74/74[0m [32m━━━━━━━━━━━━━━━━━━━━[0m[37m[0m [1m0s[0m 113ms/step - accuracy: 0.2035 - loss: 2.1419[1m74/74[0m [32m━━━━━━━━━━━━━━━━━━━━[0m[37m[0m [1m22s[0m 167ms/step - accuracy: 0.2079 - loss: 2.0047 - val_accuracy: 0.2369 - val_loss: 1.9091 - learning_rate: 0.0010
Epoch 2/20
[1m 1/74[0m [37m━━━━━━━━━━━━━━━━━━━━[0m [1m1s[0m 25ms/step - accuracy: 0.2812 - loss: 1.9548[1m15/74[0m [32m━━━━[0m[37m━━━━━━━━━━━━━━━━[0m [1m0s[0m 4ms/step - accuracy: 0.2070 - loss: 1.9332 [1m28/74[0m [32m━━━━━━━[0m[37m━━━━━━━━━━━━━[0m [1m0s[0m 4ms/step - accuracy: 0.2093 - loss: 1.9271[1m41/74[0m [32m━━━━━━━━━━━[0m[37m━━━━━━━━━[0m [1m0s[0m 4ms/step - accuracy: 0.2113 - loss: 1.9241[1m53/74[0m [32m━━━━━━━━━━━━━━[0m[37m━━━━━━[0m [1m0s[0m 4ms/step - accuracy: 0.2121 - loss: 1.9228[1m64/74[0m [32m━━━━━━━━━━━━━━━━━[0m[37m━━━[0m [1m0s[0m 4ms/step - accuracy: 0.2123 - loss: 1.9220[1m74/74[0m [32m━━━━━━━━━━━━━━━━━━━━[0m[37m[0m [1m0s[0m 6ms/step - accuracy: 0.2185 - loss: 1.9160 - val_accuracy: 0.2369 - val_loss: 1.8926 - learning_rate: 0.0010
Epoch 3/20
[1m 1/74[0m [37m━━━━━━━━━━━━━━━━━━━━[0m [1m2s[0m 28ms/step - accuracy: 0.2969 - loss: 1.9279[1m15/74[0m [32m━━━━[0m[37m━━━━━━━━━━━━━━━━[0m [1m0s[0m 4ms/step - accuracy: 0.2272 - loss: 1.9249 [1m27/74[0m [32m━━━━━━━[0m[37m━━━━━━━━━━━━━[0m [1m0s[0m 4ms/step - accuracy: 0.2229 - loss: 1.9211[1m38/74[0m [32m━━━━━━━━━━[0m[37m━━━━━━━━━━[0m [1m0s[0m 4ms/step - accuracy: 0.2230 - loss: 1.9178[1m50/74[0m [32m━━━━━━━━━━━━━[0m[37m━━━━━━━[0m [1m0s[0m 4ms/step - accuracy: 0.2239 - loss: 1.9160[1m62/74[0m [32m━━━━━━━━━━━━━━━━[0m[37m━━━━[0m [1m0s[0m 4ms/step - accuracy: 0.2247 - loss: 1.9142[1m73/74[0m [32m━━━━━━━━━━━━━━━━━━━[0m[37m━[0m [1m0s[0m 4ms/step - accuracy: 0.2258 - loss: 1.9126[1m74/74[0m [32m━━━━━━━━━━━━━━━━━━━━[0m[37m[0m [1m1s[0m 6ms/step - accuracy: 0.2322 - loss: 1.9030 - val_accuracy: 0.2369 - val_loss: 1.8970 - learning_rate: 0.0010
Epoch 4/20
[1m 1/74[0m [37m━━━━━━━━━━━━━━━━━━━━[0m [1m2s[0m 28ms/step - accuracy: 0.1719 - loss: 1.8986[1m14/74[0m [32m━━━[0m[37m━━━━━━━━━━━━━━━━━[0m [1m0s[0m 4ms/step - accuracy: 0.2248 - loss: 1.8893 [1m25/74[0m [32m━━━━━━[0m[37m━━━━━━━━━━━━━━[0m [1m0s[0m 4ms/step - accuracy: 0.2278 - loss: 1.8917[1m36/74[0m [32m━━━━━━━━━[0m[37m━━━━━━━━━━━[0m [1m0s[0m 4ms/step - accuracy: 0.2297 - loss: 1.8916[1m47/74[0m [32m━━━━━━━━━━━━[0m[37m━━━━━━━━[0m [1m0s[0m 4ms/step - accuracy: 0.2310 - loss: 1.8927[1m59/74[0m [32m━━━━━━━━━━━━━━━[0m[37m━━━━━[0m [1m0s[0m 4ms/step - accuracy: 0.2320 - loss: 1.8939[1m71/74[0m [32m━━━━━━━━━━━━━━━━━━━[0m[37m━[0m [1m0s[0m 4ms/step - accuracy: 0.2323 - loss: 1.8946[1m74/74[0m [32m━━━━━━━━━━━━━━━━━━━━[0m[37m[0m [1m1s[0m 6ms/step - accuracy: 0.2329 - loss: 1.8947 - val_accuracy: 0.2369 - val_loss: 1.8760 - learning_rate: 0.0010
Epoch 5/20
[1m 1/74[0m [37m━━━━━━━━━━━━━━━━━━━━[0m [1m1s[0m 27ms/step - accuracy: 0.1719 - loss: 1.8415[1m16/74[0m [32m━━━━[0m[37m━━━━━━━━━━━━━━━━[0m [1m0s[0m 4ms/step - accuracy: 0.2095 - loss: 1.8862 [1m27/74[0m [32m━━━━━━━[0m[37m━━━━━━━━━━━━━[0m [1m0s[0m 4ms/step - accuracy: 0.2140 - loss: 1.8882[1m38/74[0m [32m━━━━━━━━━━[0m[37m━━━━━━━━━━[0m [1m0s[0m 4ms/step - accuracy: 0.2179 - loss: 1.8860[1m49/74[0m [32m━━━━━━━━━━━━━[0m[37m━━━━━━━[0m [1m0s[0m 4ms/step - accuracy: 0.2213 - loss: 1.8837[1m60/74[0m [32m━━━━━━━━━━━━━━━━[0m[37m━━━━[0m [1m0s[0m 4ms/step - accuracy: 0.2235 - loss: 1.8817[1m71/74[0m [32m━━━━━━━━━━━━━━━━━━━[0m[37m━[0m [1m0s[0m 4ms/step - accuracy: 0.2252 - loss: 1.8803[1m74/74[0m [32m━━━━━━━━━━━━━━━━━━━━[0m[37m[0m [1m1s[0m 7ms/step - accuracy: 0.2343 - loss: 1.8712 - val_accuracy: 0.2369 - val_loss: 1.8619 - learning_rate: 0.0010
Epoch 6/20
[1m 1/74[0m [37m━━━━━━━━━━━━━━━━━━━━[0m [1m2s[0m 40ms/step - accuracy: 0.2188 - loss: 1.8812[1m16/74[0m [32m━━━━[0m[37m━━━━━━━━━━━━━━━━[0m [1m0s[0m 4ms/step - accuracy: 0.2330 - loss: 1.8402 [1m28/74[0m [32m━━━━━━━[0m[37m━━━━━━━━━━━━━[0m [1m0s[0m 4ms/step - accuracy: 0.2282 - loss: 1.8535[1m40/74[0m [32m━━━━━━━━━━[0m[37m━━━━━━━━━━[0m [1m0s[0m 4ms/step - accuracy: 0.2291 - loss: 1.8566[1m52/74[0m [32m━━━━━━━━━━━━━━[0m[37m━━━━━━[0m [1m0s[0m 4ms/step - accuracy: 0.2300 - loss: 1.8570[1m63/74[0m [32m━━━━━━━━━━━━━━━━━[0m[37m━━━[0m [1m0s[0m 4ms/step - accuracy: 0.2311 - loss: 1.8565[1m74/74[0m [32m━━━━━━━━━━━━━━━━━━━━[0m[37m[0m [1m0s[0m 4ms/step - accuracy: 0.2318 - loss: 1.8559[1m74/74[0m [32m━━━━━━━━━━━━━━━━━━━━[0m[37m[0m [1m1s[0m 7ms/step - accuracy: 0.2369 - loss: 1.8502 - val_accuracy: 0.2369 - val_loss: 1.8304 - learning_rate: 0.0010

Final Results:
Test accuracy: 0.2368 (23.68%)
Test loss: 1.9086
[1m 1/47[0m [37m━━━━━━━━━━━━━━━━━━━━[0m [1m36s[0m 789ms/step[1m27/47[0m [32m━━━━━━━━━━━[0m[37m━━━━━━━━━[0m [1m0s[0m 2ms/step   [1m47/47[0m [32m━━━━━━━━━━━━━━━━━━━━[0m[37m[0m [1m0s[0m 19ms/step[1m47/47[0m [32m━━━━━━━━━━━━━━━━━━━━[0m[37m[0m [1m2s[0m 19ms/step

Classification Report:
              precision    recall  f1-score   support

         HP1       0.00      0.00      0.00       103
         HP2       0.00      0.00      0.00       114
         HP3       0.00      0.00      0.00       139
         HP4       0.00      0.00      0.00       272
         HP5       0.24      1.00      0.38       350
         HP6       0.00      0.00      0.00       229
         HP7       0.00      0.00      0.00       271

    accuracy                           0.24      1478
   macro avg       0.03      0.14      0.05      1478
weighted avg       0.06      0.24      0.09      1478

